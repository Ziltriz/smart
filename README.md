# smart
Тестовое задание 
---

После проверки задания мы обязательно прокомментируем ваше решение. Код тестового задания не будет использован в коммерческих целях. 
Описание
stripe.com/docs - платёжная система с подробным API и бесплатным тестовым режимом для имитации и тестирования платежей. С помощью python библиотеки stripe можно удобно создавать платежные формы разных видов, сохранять данные клиента, и реализовывать прочие платежные функции. 
Мы предлагаем вам познакомиться с этой прекрасной платежной системой, реализовав простой сервер с простеньким html, который общается со Stripe и создает платёжные формы для товаров. 
Для решения нужно использовать Django. Решение бонусных задач даст вам возможность прокачаться, показать свои умения и увеличить вероятность прохождения данного этапа отбора.
Задание
Реализовать Django + Stripe API бэкенд со следующим функционалом и условиями:
Django Модель Item с полями (name, description, price) 
API с двумя методами:
GET /buy/{id}, c помощью которого можно получить Stripe Session Id для оплаты выбранного Item. При выполнении этого метода c бэкенда с помощью python библиотеки stripe должен выполняться запрос stripe.checkout.Session.create(...) и полученный session.id выдаваться в результате запроса
GET /item/{id}, c помощью которого можно получить простейшую HTML страницу, на которой будет информация о выбранном Item и кнопка Buy. По нажатию на кнопку Buy должен происходить запрос на /buy/{id}, получение session_id и далее  с помощью JS библиотеки Stripe происходить редирект на Checkout форму stripe.redirectToCheckout(sessionId=session_id)
Пример реализации можно посмотреть в пунктах 1-3 тут
Залить решение на Github, описать запуск в Readme.md
Опубликовать свое решение онлайн, предоставив ссылку на решение и доступ к админке, чтобы его можно было быстро и легко протестировать. 
Решения доступные только в виде кода на Github получат низкий приоритет при проверке.

Бонусные задачи: 
Запуск используя Docker
Использование environment variables
Просмотр Django Моделей в Django Admin панели
Запуск приложения на удаленном сервере, доступном для тестирования, с кредами от админки
Модель Order, в которой можно объединить несколько Item и сделать платёж в Stripe на содержимое Order c общей стоимостью всех Items
Модели Discount, Tax, которые можно прикрепить к модели Order и связать с соответствующими атрибутами при создании платежа в Stripe - в таком случае они корректно отображаются в Stripe Checkout форме. 
Добавить поле Item.currency, создать 2 Stripe Keypair на две разные валюты и в зависимости от валюты выбранного товара предлагать оплату в соответствующей валюте
Реализовать не Stripe Session, а Stripe Payment Intent.


# Stripe Payment Integration Project

![Django](https://img.shields.io/badge/Django-1.0-blue)
![Stripe](https://img.shields.io/badge/Stripe-API-green)
![Docker](https://img.shields.io/badge/Docker-Ready-brightgreen)

## Описание

Этот проект представляет собой веб-приложение на Django с интеграцией платежной системы **Stripe**. Он позволяет создавать товары (`Item`), заказы (`Order`) с несколькими товарами, применять скидки (`Discount`) и налоги (`Tax`), а также обрабатывать платежи через Stripe API.

Проект использует следующие технологии:
- **Django**: Веб-фреймворк для создания backend-логики.
- **Stripe API**: Для обработки платежей.
- **Docker**: Для контейнеризации приложения.
- **REST Framework**: Для создания API.

---

## Функционал

### Основные возможности:
- **Товары (`Item`)**:
  - Создание и управление товарами с названием, описанием, ценой и валютой.
  - Просмотр детальной информации о товаре с кнопкой "Купить".

- **Заказы (`Order`)**:
  - Создание заказов с несколькими товарами.
  - Применение скидок и налогов к заказу.
  - Выполнение платежей через Stripe Payment Intent или Checkout Session.

- **Скидки (`Discount`)**:
  - Создание купонов со скидкой в процентах или фиксированной сумме.
  - Настройка длительности действия скидки (forever, once, repeating).

- **Налоги (`Tax`)**:
  - Добавление налогов к заказам.

- **API**:
  - REST API для управления товарами, заказами, скидками и налогами.
  - Интеграция с Stripe для создания платежных сессий.

- **Админ-панель**:
  - Полный контроль над моделями через Django Admin.

---

## Требования

Для запуска проекта вам понадобятся следующие инструменты:
- **Python 3.9+**
- **Docker**
- **Docker Compose**

---

## Развертывание через Docker

### 1. Клонирование репозитория

Склонируйте репозиторий проекта:

```bash
git clone https://github.com/Ziltriz/smart.git
cd smart/srtipedjango
```

### 2. Настройка переменных окружения

Создайте файл `.env` в корне проекта и добавьте необходимые переменные:

```env
# Stripe Keys
STRIPE_PUBLIC_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...

# Django Settings
DEBUG=True
SECRET_KEY=your-django-secret-key
ALLOWED_HOSTS=*

# Database
POSTGRES_DB=stripe_payment
POSTGRES_USER=stripe_user
POSTGRES_PASSWORD=stripe_password
```

### 3. Запуск приложения

Используйте `docker-compose` для запуска приложения:

```bash
docker-compose up --build
```

Приложение будет доступно по адресу: [http://localhost:8000](http://localhost:8000).

---

### 4. Создание миграций и суперпользователя

Подключитесь к контейнеру Django:

```bash
docker-compose exec web python manage.py migrate
docker-compose exec web python manage.py createsuperuser
```

Создайте суперпользователя для доступа к админ-панели.

---

### 5. Админ-панель

Админ-панель доступна по адресу: [http://localhost:8000/admin](http://localhost:8000/admin).

Войдите с учетными данными суперпользователя, чтобы управлять товарами, заказами, скидками и налогами.

---

## API Endpoints

### Товары

- **GET `/item/{id}/`**: Получить информацию о товаре и кнопку "Купить".
- **GET `/buy/{id}/`**: Создать Checkout Session для оплаты товара.

### Заказы

- **GET `/order/{id}/`**: Получить информацию о заказе и кнопку "Оплатить".
- **GET `/api/create-payment-intent/{order_id}/`**: Создать Payment Intent для заказа.

---

## Тестирование платежей

Для тестирования платежей используйте тестовые данные Stripe:

- Номер карты: `4242 4242 4242 4242`
- Месяц/год: любая будущая дата
- CVV: `123`

---

## Дополнительные возможности

- **Логирование**: Все ошибки Stripe логируются в консоль.
- **Масштабируемость**: Приложение можно легко масштабировать, добавляя больше контейнеров через Docker Compose.
- **Безопасность**: Используется HTTPS для live-окружения.

---

## Авторы

- **Ziltriz**: [Ваш GitHub](https://github.com/Ziltriz)
